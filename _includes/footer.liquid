{% assign footer_strings = site.data[site.active_lang].strings.footer %}

<footer class="footer-sticky" role="contentinfo">
  <div class="footer-container">
    <div class="footer-content">
      <!-- Left Column: Action Buttons -->
      <div class="footer-actions">
        <button type="button" class="footer-button" id="openConnectModal">
          <i class="fa-solid fa-users"></i>
          <span>{{ footer_strings.connect_label }}</span>
        </button>
        <button type="button" class="footer-button" id="openShareModal">
          <i class="fa-solid fa-share-nodes"></i>
          <span>{{ footer_strings.share_label }}</span>
        </button>
      </div>

      <!-- Right Column: Navigation Links -->
      <div class="footer-links">
        <a href="{{ site.baseurl }}/about/" class="footer-link">
          <i class="fa-solid fa-user"></i>
          <span>{{ footer_strings.about_me_label }}</span>
        </a>
        <a href="{{ site.baseurl }}/colophon/" class="footer-link">
          <i class="fa-solid fa-circle-info"></i>
          <span>{{ footer_strings.colophon_label }}</span>
        </a>
        <a href="{{ site.baseurl }}/subscribe/" class="footer-link">
          <i class="fa-solid fa-square-rss"></i>
          <span>{{ footer_strings.subscribe_label }}</span>
        </a>
      </div>
    </div>

    <!-- Copyright Notice -->
    <div class="footer-attribution">
      Â© 2025 Benjamin Peeters | <a href="https://www.pik-potsdam.de/en/home" target="_blank" rel="noopener noreferrer">PIK</a> Potsdam
    </div>
  </div>

  <!-- Connect Modal -->
  <div class="connect-modal" id="connectModal" aria-hidden="true">
    <div class="connect-modal-overlay" id="connectModalOverlay"></div>
    <div class="connect-modal-content" role="dialog" aria-modal="true" aria-labelledby="connectModalTitle">
      <div class="connect-modal-header">
        <h3 id="connectModalTitle">{{ footer_strings.connect_label }}</h3>
        <button type="button" class="connect-modal-close" id="closeConnectModal" aria-label="Close">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
      <div class="connect-modal-body">
        <div class="connect-modal-grid">
          {% for social in site.data.socials %}
            {% case social[0] %}
              {% when 'scholar_userid' %}
                <a
                  href="https://scholar.google.com/citations?user={{ social[1] }}"
                  class="connect-modal-item icon-scholar"
                  title="Google Scholar"
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  <i class="ai ai-google-scholar"></i>
                  <span>Scholar</span>
                </a>
              {% when 'linkedin_username' %}
                <a
                  href="https://www.linkedin.com/in/{{ social[1] }}"
                  class="connect-modal-item icon-linkedin"
                  title="LinkedIn"
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  <i class="fa-brands fa-linkedin"></i>
                  <span>LinkedIn</span>
                </a>
              {% when 'orcid_id' %}
                <a
                  href="https://orcid.org/{{ social[1] }}"
                  class="connect-modal-item icon-orcid"
                  title="ORCID"
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  <i class="ai ai-orcid"></i>
                  <span>ORCID</span>
                </a>
              {% when 'github_username' %}
                <a
                  href="https://github.com/{{ social[1] }}"
                  class="connect-modal-item icon-github"
                  title="GitHub"
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  <i class="fa-brands fa-github"></i>
                  <span>GitHub</span>
                </a>
              {% else %}
                {% if social[1].url %}
                  <a
                    href="{{ social[1].url }}"
                    class="connect-modal-item icon-{{ social[0] | replace: '_', '-' }}"
                    title="{{ social[1].title }}"
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    {% if social[1].icon %}
                      <i class="{{ social[1].icon }}"></i>
                    {% elsif social[1].logo %}
                      <img src="{{ social[1].logo }}" alt="{{ social[1].title }}" class="connect-modal-logo">
                    {% endif %}
                    <span>{{ social[1].title }}</span>
                  </a>
                {% endif %}
            {% endcase %}
          {% endfor %}
        </div>
      </div>
    </div>
  </div>

  <!-- Share Modal -->
  {% assign page_url = page.url | absolute_url | url_encode %}
  {% assign page_url_raw = page.url | absolute_url %}
  {% assign page_title = page.title | default: site.title | url_encode %}

  <div class="share-modal" id="shareModal" aria-hidden="true">
    <div class="share-modal-overlay" id="shareModalOverlay"></div>
    <div class="share-modal-content" role="dialog" aria-modal="true" aria-labelledby="shareModalTitle">
      <div class="share-modal-header">
        <h3 id="shareModalTitle">{{ footer_strings.share_label }}</h3>
        <button type="button" class="share-modal-close" id="closeShareModal" aria-label="Close">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
      <div class="share-modal-body">
        <div class="share-modal-grid">
          <!-- Social Media -->
          <a
            href="https://www.facebook.com/sharer/sharer.php?u={{ page_url }}"
            class="share-modal-item icon-facebook"
            title="Facebook"
            target="_blank"
            rel="noopener noreferrer"
          >
            <i class="fa-brands fa-facebook"></i>
            <span>Facebook</span>
          </a>
          <a
            href="https://twitter.com/intent/tweet?url={{ page_url }}&text={{ page_title }}"
            class="share-modal-item icon-x-twitter"
            title="X (Twitter)"
            target="_blank"
            rel="noopener noreferrer"
          >
            <i class="fa-brands fa-x-twitter"></i>
            <span>X</span>
          </a>
          <a
            href="https://bsky.app/intent/compose?text={{ page_title }}%20{{ page_url }}"
            class="share-modal-item icon-bluesky"
            title="Bluesky"
            target="_blank"
            rel="noopener noreferrer"
          >
            <i class="fa-brands fa-bluesky"></i>
            <span>Bluesky</span>
          </a>
          <a
            href="https://www.threads.net/intent/post?text={{ page_title }}%20{{ page_url }}"
            class="share-modal-item icon-threads"
            title="Threads"
            target="_blank"
            rel="noopener noreferrer"
          >
            <i class="fa-brands fa-threads"></i>
            <span>Threads</span>
          </a>
          <a href="javascript:void(0);" class="share-modal-item icon-mastodon share-web" title="Mastodon" data-url="{{ page_url_raw }}">
            <i class="fa-brands fa-mastodon"></i>
            <span>Mastodon</span>
          </a>
          <a
            href="https://www.linkedin.com/sharing/share-offsite/?url={{ page_url }}"
            class="share-modal-item icon-linkedin"
            title="LinkedIn"
            target="_blank"
            rel="noopener noreferrer"
          >
            <i class="fa-brands fa-linkedin"></i>
            <span>LinkedIn</span>
          </a>
          <a
            href="https://www.reddit.com/submit?url={{ page_url }}&title={{ page_title }}"
            class="share-modal-item icon-reddit"
            title="Reddit"
            target="_blank"
            rel="noopener noreferrer"
          >
            <i class="fa-brands fa-reddit"></i>
            <span>Reddit</span>
          </a>

          <!-- Messaging -->
          <a
            href="https://wa.me/?text={{ page_title }}%20{{ page_url }}"
            class="share-modal-item icon-whatsapp"
            title="WhatsApp"
            target="_blank"
            rel="noopener noreferrer"
          >
            <i class="fa-brands fa-whatsapp"></i>
            <span>WhatsApp</span>
          </a>
          <a
            href="https://t.me/share/url?url={{ page_url }}&text={{ page_title }}"
            class="share-modal-item icon-telegram"
            title="Telegram"
            target="_blank"
            rel="noopener noreferrer"
          >
            <i class="fa-brands fa-telegram"></i>
            <span>Telegram</span>
          </a>
          <a href="javascript:void(0);" class="share-modal-item icon-wechat share-web" title="WeChat" data-url="{{ page_url_raw }}">
            <i class="fa-brands fa-weixin"></i>
            <span>WeChat</span>
          </a>
          <a
            href="https://social-plugins.line.me/lineit/share?url={{ page_url }}"
            class="share-modal-item icon-line"
            title="LINE"
            target="_blank"
            rel="noopener noreferrer"
          >
            <i class="fa-brands fa-line"></i>
            <span>LINE</span>
          </a>
          <a href="javascript:void(0);" class="share-modal-item icon-discord share-web" title="Discord" data-url="{{ page_url_raw }}">
            <i class="fa-brands fa-discord"></i>
            <span>Discord</span>
          </a>

          <!-- Other -->
          <a
            href="https://vk.com/share.php?url={{ page_url }}&title={{ page_title }}"
            class="share-modal-item icon-vk"
            title="VK"
            target="_blank"
            rel="noopener noreferrer"
          >
            <i class="fa-brands fa-vk"></i>
            <span>VK</span>
          </a>
          <a href="mailto:?subject={{ page_title }}&body={{ page_url }}" class="share-modal-item icon-email" title="Email">
            <i class="fa-solid fa-envelope"></i>
            <span>Email</span>
          </a>
          <a
            href="javascript:void(0);"
            class="share-modal-item icon-copy copy-link-button"
            title="{{ footer_strings.copy_link }}"
            data-url="{{ page_url_raw }}"
          >
            <i class="fa-solid fa-link"></i>
            <span>{{ footer_strings.copy_link }}</span>
          </a>
        </div>
      </div>
    </div>
  </div>
</footer>

<!-- Footer JavaScript for Modals and Share Functions -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Connect Modal
    const connectModal = document.getElementById('connectModal');
    const openConnectBtn = document.getElementById('openConnectModal');
    const closeConnectBtn = document.getElementById('closeConnectModal');
    const connectOverlay = document.getElementById('connectModalOverlay');

    function openConnectModal() {
      connectModal.classList.add('open');
      connectModal.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
    }

    function closeConnectModal() {
      connectModal.classList.remove('open');
      connectModal.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
    }

    if (openConnectBtn) openConnectBtn.addEventListener('click', openConnectModal);
    if (closeConnectBtn) closeConnectBtn.addEventListener('click', closeConnectModal);
    if (connectOverlay) connectOverlay.addEventListener('click', closeConnectModal);

    // Share Modal
    const shareModal = document.getElementById('shareModal');
    const openShareBtn = document.getElementById('openShareModal');
    const closeShareBtn = document.getElementById('closeShareModal');
    const shareOverlay = document.getElementById('shareModalOverlay');

    function openShareModal() {
      shareModal.classList.add('open');
      shareModal.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
    }

    function closeShareModal() {
      shareModal.classList.remove('open');
      shareModal.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
    }

    if (openShareBtn) openShareBtn.addEventListener('click', openShareModal);
    if (closeShareBtn) closeShareBtn.addEventListener('click', closeShareModal);
    if (shareOverlay) shareOverlay.addEventListener('click', closeShareModal);

    // Close modals on Escape key
    document.addEventListener('keydown', function (e) {
      if (e.key === 'Escape') {
        if (connectModal.classList.contains('open')) closeConnectModal();
        if (shareModal.classList.contains('open')) closeShareModal();
      }
    });

    // Copy Link Button
    const copyButtons = document.querySelectorAll('.copy-link-button');

    copyButtons.forEach((button) => {
      button.addEventListener('click', function (e) {
        e.preventDefault();
        const url = this.dataset.url;
        const feedback = this.querySelector('.copy-feedback');

        navigator.clipboard
          .writeText(url)
          .then(() => {
            if (feedback) {
              feedback.classList.add('show');
              setTimeout(() => {
                feedback.classList.remove('show');
              }, 2000);
            }
          })
          .catch((err) => {
            console.error('Failed to copy:', err);
          });
      });
    });

    // Web Share API for platforms without direct share URLs
    const shareWebButtons = document.querySelectorAll('.share-web');

    shareWebButtons.forEach((button) => {
      button.addEventListener('click', function (e) {
        e.preventDefault();
        const url = this.dataset.url;
        const title = document.title;

        if (navigator.share) {
          navigator
            .share({
              title: title,
              url: url,
            })
            .catch((err) => {
              // Fallback: copy to clipboard
              navigator.clipboard.writeText(url);
            });
        } else {
          // Fallback: copy to clipboard
          navigator.clipboard.writeText(url);
          alert('{{ footer_strings.link_copied }}');
        }
      });
    });
  });
</script>
