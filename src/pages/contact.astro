---
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import { SITE_TITLE, GITHUB_USERNAME, INSTITUTION, DEPARTMENT } from '../consts';
import { t } from '../i18n';

const locale = 'en';
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={`${t(locale, 'contact.title')} - ${SITE_TITLE}`} description="Get in touch with Benjamin Peeters" />
		<script src="https://js.hcaptcha.com/1/api.js" async defer></script>
	</head>
	<body>
		<Header />
		<main>
			<article>
				<h1>{t(locale, 'contact.title')}</h1>

				<section class="intro">
					<p>{t(locale, 'contact.intro')}</p>
				</section>

				<div class="contact-grid">
					<section class="contact-info-card">
						<h2>{t(locale, 'contact.location')}</h2>
						<p>
							<strong>{INSTITUTION}</strong><br>
							{t(locale, 'contact.department')}<br>
							{t(locale, 'contact.city')}
						</p>
					</section>

					<section class="contact-info-card">
						<h2>{t(locale, 'contact.github.title')}</h2>
						<p>{t(locale, 'contact.github.text')}</p>
						<a href={`https://github.com/${GITHUB_USERNAME}`} target="_blank" class="github-link">
							<svg viewBox="0 0 16 16" aria-hidden="true" width="24" height="24">
								<path
									fill="currentColor"
									d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"
								></path>
							</svg>
							@{GITHUB_USERNAME}
						</a>
					</section>
				</div>

				<section class="contact-form-section">
					<h2>{t(locale, 'contact.form.title')}</h2>
					<form class="contact-form" id="contact-form" method="POST" action="https://formcarry.com/s/_n_QcqvTqp6">
						<input type="hidden" name="language" value="en">

						<div class="form-group">
							<label for="name">{t(locale, 'contact.form.name')} <span class="required">{t(locale, 'contact.form.required')}</span></label>
							<input type="text" id="name" name="name" required>
						</div>

						<div class="form-group">
							<label for="email">{t(locale, 'contact.form.email')} <span class="required">{t(locale, 'contact.form.required')}</span></label>
							<input type="email" id="email" name="email" required>
						</div>

						<div class="form-group">
							<label for="subject">{t(locale, 'contact.form.subject')} <span class="required">{t(locale, 'contact.form.required')}</span></label>
							<input type="text" id="subject" name="subject" required>
						</div>

						<div class="form-group">
							<label for="message">{t(locale, 'contact.form.message')} <span class="required">{t(locale, 'contact.form.required')}</span></label>
							<textarea id="message" name="message" rows="6" required></textarea>
						</div>

						<div class="form-group">
							<div class="h-captcha" data-sitekey="f3daf6a4-fe6c-4090-ba50-1810dd7210cc"></div>
						</div>

						<button type="submit" class="submit-button">
							<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<line x1="22" y1="2" x2="11" y2="13"></line>
								<polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
							</svg>
							{t(locale, 'contact.form.submit')}
						</button>
					</form>

					<div id="form-status"></div>
				</section>
			</article>
		</main>
		<Footer />
	</body>
</html>

<style>
	article {
		max-width: 900px;
		margin: 0 auto;
		padding: 2rem 1rem;
	}

	h1 {
		font-size: 2.5rem;
		margin-bottom: 1rem;
		color: var(--accent);
	}

	section {
		margin: 2rem 0;
	}

	.intro {
		font-size: 1.1rem;
		line-height: 1.6;
		color: var(--text-secondary);
		margin-bottom: 3rem;
	}

	.contact-grid {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
		gap: 2rem;
		margin: 3rem 0;
	}

	.contact-info-card {
		padding: 2rem;
		background-color: var(--card-bg);
		border-radius: 8px;
		border-left: 4px solid var(--accent);
		transition: box-shadow 0.3s ease, transform 0.3s ease;
	}

	.contact-info-card:hover {
		box-shadow: 0 4px 12px rgba(45, 126, 63, 0.15);
		transform: translateY(-2px);
	}

	.contact-info-card h2 {
		margin-top: 0;
		color: var(--accent);
		font-size: 1.3rem;
		margin-bottom: 1rem;
	}

	.contact-info-card p {
		margin: 0.5rem 0;
		line-height: 1.6;
	}

	.github-link {
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		padding: 0.75rem 1.25rem;
		margin-top: 1rem;
		background-color: #24292e;
		color: white;
		text-decoration: none;
		border-radius: 6px;
		font-weight: 500;
		transition: background-color 0.3s ease;
	}

	.github-link:hover {
		background-color: #2d7e3f;
	}

	.github-link svg {
		flex-shrink: 0;
	}

	.contact-form-section {
		margin-top: 4rem;
		padding: 2.5rem;
		background-color: var(--card-bg);
		border-radius: 8px;
	}

	.contact-form-section h2 {
		margin-top: 0;
		color: var(--accent);
		font-size: 1.5rem;
		margin-bottom: 2rem;
	}

	.contact-form {
		max-width: 600px;
	}

	.form-group {
		margin-bottom: 1.5rem;
	}

	.form-group label {
		display: block;
		margin-bottom: 0.5rem;
		font-weight: 500;
		color: var(--text-primary);
	}

	.required {
		color: #e74c3c;
		font-size: 0.9rem;
		font-weight: normal;
	}

	.form-group input,
	.form-group textarea {
		width: 100%;
		padding: 0.75rem;
		border: 2px solid var(--border-color);
		border-radius: 6px;
		font-size: 1rem;
		font-family: inherit;
		transition: border-color 0.3s ease, box-shadow 0.3s ease;
		background-color: var(--bg);
		color: var(--text-primary);
	}

	.form-group input:focus,
	.form-group textarea:focus {
		outline: none;
		border-color: var(--accent);
		box-shadow: 0 0 0 3px rgba(45, 126, 63, 0.1);
	}

	.form-group textarea {
		resize: vertical;
		min-height: 120px;
	}

	.submit-button {
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		padding: 0.875rem 2rem;
		background-color: var(--accent);
		color: white;
		border: none;
		border-radius: 6px;
		font-size: 1rem;
		font-weight: 600;
		cursor: pointer;
		transition: background-color 0.3s ease, transform 0.3s ease;
	}

	.submit-button:hover {
		background-color: #236d37;
		transform: translateY(-1px);
	}

	.submit-button:active {
		transform: translateY(0);
	}

	#form-status {
		margin-top: 1.5rem;
		padding: 1rem;
		border-radius: 6px;
		display: none;
	}

	#form-status.success {
		display: block;
		background-color: #d4edda;
		color: #155724;
		border: 1px solid #c3e6cb;
	}

	#form-status.error {
		display: block;
		background-color: #f8d7da;
		color: #721c24;
		border: 1px solid #f5c6cb;
	}

	@media (max-width: 768px) {
		h1 {
			font-size: 2rem;
		}

		.contact-grid {
			grid-template-columns: 1fr;
			gap: 1.5rem;
		}

		.contact-info-card {
			padding: 1.5rem;
		}

		.contact-form-section {
			padding: 1.5rem;
		}
	}
</style>

<script>
	const form = document.getElementById('contact-form') as HTMLFormElement;
	const status = document.getElementById('form-status') as HTMLDivElement;

	form.addEventListener('submit', async (e) => {
		e.preventDefault();

		const formData = new FormData(form);

		try {
			const response = await fetch(form.action, {
				method: 'POST',
				body: formData,
				headers: {
					Accept: 'application/json',
				},
			});

			if (response.ok) {
				status.textContent = 'Thank you for your message! I will get back to you soon.';
				status.className = 'success';
				form.reset();

				// Reset hCaptcha if available
				if (typeof (window as any).hcaptcha !== 'undefined') {
					(window as any).hcaptcha.reset();
				}
			} else {
				status.textContent = 'Oops! There was a problem submitting your form.';
				status.className = 'error';
			}
		} catch (error) {
			status.textContent = 'Oops! There was a problem submitting your form.';
			status.className = 'error';
		}
	});
</script>
