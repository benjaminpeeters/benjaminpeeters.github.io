<div class="language-switcher">
  <button class="language-toggle" aria-label="Select language" aria-expanded="false">
    <svg class="language-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="10"></circle>
      <path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
    </svg>
    <span class="current-lang">
      {% for language in site.languages %}
        {% if language.code == (lang or 'en') %}{{ language.code | upper }}{% endif %}
      {% endfor %}
    </span>
    <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polyline points="6 9 12 15 18 9"></polyline>
    </svg>
  </button>
  <ul class="language-dropdown">
    {% for language in site.languages %}
      <li class="language-item{% if language.code == (lang or 'en') %} active{% endif %}">
        <a href="{{ page.url | replace('/en/', '/' + language.code + '/') | replace('/fr/', '/' + language.code + '/') | replace('/zh/', '/' + language.code + '/') }}"
           lang="{{ language.code }}"
           hreflang="{{ language.code }}">
          {{ language.label }}
        </a>
      </li>
    {% endfor %}
  </ul>
</div>

<script>
  // Language dropdown toggle
  document.addEventListener('DOMContentLoaded', function() {
    const toggle = document.querySelector('.language-toggle');
    const dropdown = document.querySelector('.language-dropdown');

    if (toggle && dropdown) {
      toggle.addEventListener('click', function(e) {
        e.stopPropagation();
        const isExpanded = toggle.getAttribute('aria-expanded') === 'true';
        toggle.setAttribute('aria-expanded', !isExpanded);
        dropdown.classList.toggle('show');
      });

      // Close dropdown when clicking outside
      document.addEventListener('click', function() {
        toggle.setAttribute('aria-expanded', 'false');
        dropdown.classList.remove('show');
      });
    }
  });
</script>
