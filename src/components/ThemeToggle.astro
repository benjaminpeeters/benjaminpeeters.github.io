---
// Theme Toggle Component with auto-detection and persistence
---

<button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode" title="Toggle dark/light mode">
  <svg class="sun-icon" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor">
    <circle cx="10" cy="10" r="4" stroke-width="2"/>
    <line x1="10" y1="2" x2="10" y2="4" stroke-width="2" stroke-linecap="round"/>
    <line x1="10" y1="16" x2="10" y2="18" stroke-width="2" stroke-linecap="round"/>
    <line x1="18" y1="10" x2="16" y2="10" stroke-width="2" stroke-linecap="round"/>
    <line x1="4" y1="10" x2="2" y2="10" stroke-width="2" stroke-linecap="round"/>
    <line x1="15.66" y1="4.34" x2="14.24" y2="5.76" stroke-width="2" stroke-linecap="round"/>
    <line x1="5.76" y1="14.24" x2="4.34" y2="15.66" stroke-width="2" stroke-linecap="round"/>
    <line x1="15.66" y1="15.66" x2="14.24" y2="14.24" stroke-width="2" stroke-linecap="round"/>
    <line x1="5.76" y1="5.76" x2="4.34" y2="4.34" stroke-width="2" stroke-linecap="round"/>
  </svg>
  <svg class="moon-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
    <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/>
  </svg>
</button>

<script>
  // Theme management
  const THEME_KEY = 'theme-preference';

  function getThemePreference() {
    // Check localStorage first
    const stored = localStorage.getItem(THEME_KEY);
    if (stored) {
      return stored;
    }

    // Check system preference
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return 'dark';
    }

    return 'light';
  }

  function setTheme(theme: string) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem(THEME_KEY, theme);
    updateThemeIcon(theme);
  }

  function updateThemeIcon(theme: string) {
    const button = document.getElementById('theme-toggle');
    if (!button) return;

    const sunIcon = button.querySelector('.sun-icon');
    const moonIcon = button.querySelector('.moon-icon');

    if (theme === 'dark') {
      sunIcon?.classList.add('hidden');
      moonIcon?.classList.remove('hidden');
    } else {
      sunIcon?.classList.remove('hidden');
      moonIcon?.classList.add('hidden');
    }
  }

  function toggleTheme() {
    const current = document.documentElement.getAttribute('data-theme') || 'light';
    const next = current === 'light' ? 'dark' : 'light';
    setTheme(next);
  }

  // Initialize theme on page load
  const theme = getThemePreference();
  setTheme(theme);

  // Listen for toggle button clicks
  const toggleButton = document.getElementById('theme-toggle');
  if (toggleButton) {
    toggleButton.addEventListener('click', toggleTheme);
  }

  // Listen for system theme changes
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
    // Only auto-update if user hasn't manually set a preference
    if (!localStorage.getItem(THEME_KEY)) {
      setTheme(e.matches ? 'dark' : 'light');
    }
  });
</script>

<style>
  .theme-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0.5em;
    background: transparent;
    border: 1px solid transparent;
    border-radius: 4px;
    cursor: pointer;
    color: #666;
    transition: all 0.2s ease;
  }

  .theme-toggle:hover {
    background: #f5f5f5;
    border-color: #2d7e3f;
    color: #2d7e3f;
  }

  .sun-icon,
  .moon-icon {
    display: block;
    width: 20px;
    height: 20px;
  }

  .hidden {
    display: none;
  }

  @media (max-width: 768px) {
    .theme-toggle {
      padding: 0.4em;
    }

    .sun-icon,
    .moon-icon {
      width: 18px;
      height: 18px;
    }
  }
</style>
