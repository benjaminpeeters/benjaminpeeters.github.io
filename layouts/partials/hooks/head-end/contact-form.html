{{- if .IsPage -}}
{{- if eq .Type "page" -}}
{{- if in .RelPermalink "/contact" -}}
<!-- hCaptcha Script -->
<script src="https://js.hcaptcha.com/1/api.js" async defer></script>

<!-- Contact Form Handler -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('contact-form');
  const formStatus = document.getElementById('form-status');

  if (form) {
    form.addEventListener('submit', async function(e) {
      e.preventDefault();

      const submitButton = form.querySelector('button[type="submit"]');
      const originalButtonText = submitButton.textContent;

      // Disable button and show loading state
      submitButton.disabled = true;
      submitButton.textContent = 'Sending...';

      try {
        const formData = new FormData(form);
        const response = await fetch(form.action, {
          method: 'POST',
          body: formData,
          headers: {
            'Accept': 'application/json'
          }
        });

        if (response.ok) {
          // Success
          formStatus.className = 'form-status success';
          formStatus.textContent = 'Thank you! Your message has been sent successfully.';
          formStatus.style.display = 'block';
          form.reset();

          // Reset hCaptcha
          if (typeof hcaptcha !== 'undefined') {
            hcaptcha.reset();
          }
        } else {
          // Error
          const data = await response.json();
          formStatus.className = 'form-status error';
          formStatus.textContent = data.error || 'Oops! There was a problem sending your message. Please try again.';
          formStatus.style.display = 'block';
        }
      } catch (error) {
        formStatus.className = 'form-status error';
        formStatus.textContent = 'Oops! There was a problem sending your message. Please try again.';
        formStatus.style.display = 'block';
      } finally {
        // Re-enable button
        submitButton.disabled = false;
        submitButton.textContent = originalButtonText;
      }
    });
  }
});
</script>
{{- end -}}
{{- end -}}
{{- end -}}
